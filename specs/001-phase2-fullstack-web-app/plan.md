# Implementation Plan: Phase II Full-Stack Web Application

**Branch**: `001-phase2-fullstack-web-app` | **Date**: 2025-12-30 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-phase2-fullstack-web-app/spec.md`

**Note**: This plan follows the spec-driven development workflow defined in `.specify/memory/constitution.md`.

## Summary

Transform Phase I console todo application into a modern full-stack web application with:
- **Multi-user authentication** using Better Auth with JWT tokens
- **Database persistence** with Neon Serverless PostgreSQL
- **RESTful API backend** built with Python FastAPI and SQLModel ORM
- **Responsive web UI** using Next.js 16+ App Router, TypeScript, and Tailwind CSS
- **Secure deployment** with frontend on Vercel and backend publicly accessible

This represents a complete architectural transformation from single-user console application to multi-tenant web application with proper security boundaries, data persistence, and modern web UX.

## Technical Context

**Language/Version**:
- **Frontend**: TypeScript 5.x with Next.js 16+ (App Router), Node.js 18+
- **Backend**: Python 3.11+ with FastAPI 0.100+

**Primary Dependencies**:
- **Frontend**: Next.js 16+, React 18+, Tailwind CSS 3.x, Better Auth client, TypeScript
- **Backend**: FastAPI, SQLModel, Pydantic, python-jose (JWT), uvicorn, asyncpg
- **Database**: Neon Serverless PostgreSQL (PostgreSQL 16)
- **Authentication**: Better Auth with JWT tokens

**Storage**: Neon Serverless PostgreSQL with connection pooling and automatic backups

**Testing**:
- **Frontend**: Jest + React Testing Library (optional for Phase II)
- **Backend**: Pytest + pytest-asyncio (optional for Phase II)
- **E2E**: Playwright for critical user journeys (optional)

**Target Platform**: Web browsers (Chrome, Firefox, Safari, Edge) on desktop, tablet, and mobile devices

**Project Type**: Web (monorepo with separate frontend and backend)

**Performance Goals**:
- Frontend first load < 3 seconds on 4G connection
- API response time < 200ms for CRUD operations
- Support 50+ concurrent authenticated users
- Time to Interactive < 5 seconds

**Constraints**:
- MUST use Next.js App Router (NOT Pages Router)
- MUST use TypeScript strict mode for frontend
- MUST use Python type hints for all backend functions
- MUST deploy frontend to Vercel specifically
- MUST follow spec-driven development (no manual coding)
- MUST use monorepo structure (frontend + backend in same repo)

**Scale/Scope**:
- Multi-user task management (10-100 users for hackathon demo)
- 4 prioritized user stories (P1-P3)
- 37 functional requirements across 5 domains
- 12 measurable success criteria
- Frontend + Backend monorepo with ~20-30 source files total

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

- [x] **I. Spec-Driven Development**: Plan follows spec-driven methodology - specification created first, code will be generated by Claude Code, no manual coding
- [x] **II. Mandatory Technology Stack**: Uses Next.js 16+ App Router, FastAPI, SQLModel, Neon PostgreSQL, Better Auth, monorepo structure, Vercel deployment
- [x] **III. Multi-User Architecture**: Design includes JWT authentication, user isolation via user_id filtering, no shared state
- [x] **IV. Database-First Persistence**: All data persists in Neon PostgreSQL, no in-memory storage, SQLModel for schema management
- [x] **V. Security-First Design**: JWT secrets in environment variables, Better Auth for password hashing, HTTPS only, CORS configured, input validation with Pydantic, SQLModel parameterized queries
- [x] **VI. Responsive Web Design**: Mobile-first approach, Tailwind breakpoints, touch-friendly UI, WCAG 2.1 AA accessibility, keyboard navigation
- [x] **VII. RESTful API Design**: Standard HTTP methods (GET/POST/PUT/DELETE), resource-based URLs, appropriate status codes, JSON format, OpenAPI docs via FastAPI
- [x] **VIII. Test-Driven Development**: Testing optional for Phase II per constitution (time-constrained hackathon environment)

### Technical Constraints Compliance

- [x] **Frontend**: Next.js 16+ with App Router ✓, TypeScript strict ✓, Tailwind CSS ✓, Better Auth client ✓, React Server Components ✓
- [x] **Backend**: Python 3.11+ ✓, FastAPI ✓, SQLModel ✓, Pydantic validation ✓, JWT middleware ✓, CORS middleware ✓
- [x] **Database**: Neon Serverless PostgreSQL ✓, Connection pooling ✓, SQLModel migrations ✓, Indexed queries ✓
- [x] **Deployment**: Vercel for frontend ✓, Public backend URL ✓, Health endpoint ✓, Neon database ✓
- [x] **Prohibited Items**: No console-only interface ✓, No in-memory storage ✓, No single-user assumption ✓, No manual auth ✓, No Pages Router ✓, No untyped code ✓

### Architecture Compliance

- [x] **Monorepo Structure**: frontend/ and backend/ directories in same repository per constitution diagram
- [x] **Authentication Flow**: Better Auth → JWT → FastAPI verification → Database filtering by user_id
- [x] **RESTful Endpoints**: All required endpoints defined: /api/auth/*, /api/tasks, /api/tasks/{id}, /health
- [x] **Database Schema**: Users table (Better Auth managed), Tasks table with proper indexes and foreign key constraints

### Code Quality Standards

- [x] **Frontend Standards**: TypeScript strict mode, App Router, Server Components default, Tailwind utilities, centralized API client
- [x] **Backend Standards**: Type hints for all functions, Pydantic models for validation, HTTPException for errors, middleware for JWT/CORS
- [x] **Database Standards**: SQLModel for schema, connection pooling, indexes for performance, query optimization

### Security Requirements

- [x] **Authentication**: JWT secret ≥32 chars in env, 7-day access + 30-day refresh tokens, Better Auth bcrypt hashing, HTTPS enforced
- [x] **API Security**: CORS allows only frontend domain, rate limiting 100 req/min on auth endpoints, Pydantic input validation, SQLModel parameterized queries
- [x] **Data Security**: User isolation via user_id filtering, input validation (length/format/type), generic error messages to users, authorization checks

### Performance Requirements

- [x] **Frontend**: <3s first load ✓, <5s Time to Interactive ✓, optimized bundles ✓, Next.js Image optimization ✓
- [x] **Backend**: <200ms API response for CRUD ✓, <100ms database queries ✓, 10+ concurrent users support ✓
- [x] **Database**: Connection pool configured ✓, indexed queries ✓, optimized for read-heavy workload ✓

### **Constitution Check Result: ✅ PASS**

All constitutional requirements satisfied. Plan aligns with Phase II transformation requirements. No violations requiring justification in Complexity Tracking section.

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
Phase-II/                           # Repository root (monorepo)
├── .specify/                       # Spec-Kit Plus configuration
│   ├── memory/
│   │   └── constitution.md        # Phase II Constitution v2.0.0
│   ├── templates/                 # Spec, plan, task templates
│   └── scripts/                   # PowerShell automation scripts
│
├── specs/                          # Feature specifications
│   └── 001-phase2-fullstack-web-app/
│       ├── spec.md                # Requirements (37 FRs, 4 user stories)
│       ├── plan.md                # This file - architecture plan
│       ├── research.md            # Phase 0 output (to be created)
│       ├── data-model.md          # Phase 1 output (to be created)
│       ├── quickstart.md          # Phase 1 output (to be created)
│       ├── contracts/             # Phase 1 API contracts (to be created)
│       ├── tasks.md               # Phase 2 output (created by /sp.tasks)
│       └── checklists/
│           └── requirements.md    # Quality validation checklist
│
├── history/                        # Development history
│   ├── prompts/                   # Prompt History Records
│   │   ├── constitution/          # Constitution PHRs
│   │   ├── 001-phase2-fullstack-web-app/  # Feature PHRs
│   │   └── general/               # General PHRs
│   └── adr/                       # Architecture Decision Records
│
├── frontend/                       # Next.js 16+ App Router application
│   ├── app/                       # App Router directory
│   │   ├── (auth)/               # Route group for auth pages
│   │   │   ├── login/
│   │   │   │   └── page.tsx      # Login page
│   │   │   └── signup/
│   │   │       └── page.tsx      # Signup page
│   │   ├── dashboard/            # Protected dashboard route
│   │   │   └── page.tsx          # Main dashboard with tasks
│   │   ├── layout.tsx            # Root layout with auth context
│   │   └── page.tsx              # Landing page
│   │
│   ├── components/                # React components
│   │   ├── ui/                   # Reusable UI components
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Modal.tsx
│   │   │   └── Toast.tsx
│   │   ├── auth/                 # Auth-specific components
│   │   │   ├── LoginForm.tsx
│   │   │   ├── SignupForm.tsx
│   │   │   └── AuthGuard.tsx
│   │   └── task/                 # Task-specific components
│   │       ├── TaskList.tsx
│   │       ├── TaskItem.tsx
│   │       ├── TaskForm.tsx
│   │       └── TaskFilters.tsx
│   │
│   ├── lib/                       # Utilities and configurations
│   │   ├── api.ts                # API client with JWT token handling
│   │   ├── auth.ts               # Better Auth client configuration
│   │   └── types.ts              # TypeScript type definitions
│   │
│   ├── public/                    # Static assets
│   │   └── favicon.ico
│   │
│   ├── .env.example               # Environment variables template
│   ├── .env.local                 # Local environment variables (gitignored)
│   ├── next.config.js             # Next.js configuration
│   ├── tailwind.config.js         # Tailwind CSS configuration
│   ├── tsconfig.json              # TypeScript strict configuration
│   ├── package.json               # Frontend dependencies
│   └── CLAUDE.md                  # Frontend-specific guidelines
│
├── backend/                        # FastAPI application
│   ├── app/                       # Application package
│   │   ├── __init__.py
│   │   ├── main.py               # FastAPI app entry point
│   │   ├── database.py           # Database connection and session
│   │   ├── config.py             # Settings with Pydantic BaseSettings
│   │   │
│   │   ├── models/               # SQLModel database models
│   │   │   ├── __init__.py
│   │   │   ├── user.py           # User model (Better Auth)
│   │   │   └── task.py           # Task model
│   │   │
│   │   ├── schemas/              # Pydantic request/response schemas
│   │   │   ├── __init__.py
│   │   │   ├── auth.py           # Auth schemas (SignupRequest, LoginRequest)
│   │   │   └── task.py           # Task schemas (TaskCreate, TaskUpdate, TaskResponse)
│   │   │
│   │   ├── routes/               # API route handlers
│   │   │   ├── __init__.py
│   │   │   ├── auth.py           # /api/auth/* endpoints
│   │   │   ├── tasks.py          # /api/tasks endpoints
│   │   │   └── health.py         # /health endpoint
│   │   │
│   │   └── middleware/           # Middleware components
│   │       ├── __init__.py
│   │       ├── auth.py           # JWT verification middleware
│   │       └── cors.py           # CORS configuration
│   │
│   ├── tests/                     # Backend tests (optional for Phase II)
│   │   ├── __init__.py
│   │   ├── conftest.py           # Pytest fixtures
│   │   ├── test_auth.py          # Auth endpoint tests
│   │   └── test_tasks.py         # Task CRUD tests
│   │
│   ├── .env.example               # Environment variables template
│   ├── .env                       # Local environment variables (gitignored)
│   ├── requirements.txt           # Python dependencies
│   ├── pyproject.toml             # Python project config (optional)
│   └── CLAUDE.md                  # Backend-specific guidelines
│
├── .gitignore                      # Git ignore rules
├── docker-compose.yml              # Local development environment (optional)
├── README.md                       # Project documentation
└── CLAUDE.md                       # Root-level development guidelines
```

**Structure Decision**: Web application (Option 2) with monorepo structure

**Rationale**:
- **Monorepo** enables shared specifications, version control, and deployment coordination
- **Frontend separation** isolates Next.js App Router with TypeScript strict mode
- **Backend separation** isolates Python FastAPI with clear package structure
- **Route groups** in Next.js (`(auth)`) organize related pages without affecting URL structure
- **Modular components** separate UI primitives, auth logic, and task features for maintainability
- **Middleware layer** centralizes cross-cutting concerns (JWT verification, CORS)
- **Environment variables** separated per service with .example templates for documentation

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No constitutional violations** - all requirements satisfied. This section remains empty.

---

## Implementation Phases Summary

### Phase 0: Research ✅ COMPLETE

**Status**: All technical uncertainties resolved
**Output**: [research.md](./research.md)

**Key Findings**:
1. Better Auth integration with Next.js App Router documented
2. Neon PostgreSQL connection with SQLModel verified
3. JWT verification middleware pattern established
4. CORS configuration for cross-origin requests defined
5. Next.js route organization with route groups planned
6. Tailwind responsive design configuration validated
7. Environment variables management strategy documented
8. Database schema with user isolation designed
9. Error handling across full stack standardized
10. Monorepo deployment strategy to Vercel + Railway confirmed

**No NEEDS CLARIFICATION markers remaining** - ready for Phase 1.

---

### Phase 1: Design ✅ COMPLETE

**Status**: All design artifacts created
**Outputs**:
- [data-model.md](./data-model.md) - Complete data model with SQLModel, Pydantic, TypeScript types
- [contracts/auth-api.md](./contracts/auth-api.md) - Authentication API contract
- [contracts/tasks-api.md](./contracts/tasks-api.md) - Task management API contract
- [quickstart.md](./quickstart.md) - Setup and deployment guide

**Design Highlights**:
- **Database Schema**: Users table (Better Auth managed), Tasks table with proper indexes and cascade delete
- **SQLModel Models**: Type-safe ORM with Pydantic validation
- **Pydantic Schemas**: Request/response validation for all endpoints
- **TypeScript Interfaces**: Frontend types matching backend schemas exactly
- **API Contracts**: RESTful endpoints with complete documentation, error responses, test cases
- **Quickstart Guide**: Step-by-step setup from prerequisites through production deployment

**Type Safety Guaranteed**: Full stack type safety from database → backend → frontend

---

### Phase 2: Tasks Generation (Next Step)

**Command**: `/sp.tasks`

**Input**: This plan.md + spec.md + design artifacts

**Expected Output**: `tasks.md` with:
- Dependency-ordered implementation tasks
- Each task with:
  - Clear acceptance criteria
  - File paths to create/modify
  - Code references
  - Test requirements
  - Estimated complexity

**Task Categories** (estimated):
1. **Environment Setup**: 3-5 tasks (monorepo structure, dependencies, env variables)
2. **Backend Foundation**: 8-12 tasks (database, models, middleware, auth)
3. **Backend API**: 8-10 tasks (auth endpoints, task endpoints, error handling)
4. **Frontend Foundation**: 6-8 tasks (Next.js setup, Tailwind, layouts, routing)
5. **Frontend Components**: 10-15 tasks (UI components, auth forms, task components)
6. **Frontend Integration**: 5-7 tasks (API client, auth context, task management)
7. **Testing**: 5-10 tasks (unit tests, integration tests, E2E tests - optional)
8. **Deployment**: 4-6 tasks (Vercel frontend, Railway backend, env config)

**Total Estimated Tasks**: 49-73 tasks

---

## Implementation Strategy

### Development Order (User Story Priority)

**P1 - MVP (User Story 1)**:
1. Basic environment setup (monorepo, dependencies)
2. Database schema creation (Users, Tasks tables)
3. Backend auth endpoints (signup, login)
4. Backend task endpoints (create, list, get)
5. Frontend auth pages (signup, login)
6. Frontend dashboard with task list
7. Frontend task creation form

**Delivers**: User registration + first task creation (minimum viable product)

**P2 - Full CRUD (User Stories 2 & 4)**:
1. Backend task update/delete endpoints
2. Frontend task editing UI
3. Frontend task deletion with confirmation
4. Session management (logout, token refresh)
5. Error handling throughout stack

**Delivers**: Complete task lifecycle + secure session management

**P3 - Responsive UX (User Story 3)**:
1. Responsive layout (mobile/tablet/desktop)
2. Touch-friendly UI components
3. Loading states and optimistic updates
4. Empty states and helpful messages

**Delivers**: Professional, responsive user experience

### Technology Constraints (Non-Negotiable)

From constitution and spec:
- ✅ Next.js 16+ with App Router (NOT Pages Router)
- ✅ TypeScript strict mode for all frontend code
- ✅ Python 3.11+ with type hints for all backend functions
- ✅ FastAPI with SQLModel ORM (NOT raw SQL or other ORMs)
- ✅ Neon Serverless PostgreSQL (NOT other databases)
- ✅ Better Auth with JWT tokens (NOT custom auth)
- ✅ Tailwind CSS for styling (NOT custom CSS or other frameworks)
- ✅ Vercel deployment for frontend (NOT other platforms)
- ✅ Monorepo structure (frontend + backend in same repo)

### Success Criteria Checkpoints

After tasks completion, verify:

**Functional** (from spec SC-001 to SC-006):
- [ ] User registration completes in < 2 minutes (90th percentile)
- [ ] Login and dashboard load in < 5 seconds on 4G
- [ ] Task CRUD operations complete in < 1 second
- [ ] 50+ concurrent users supported without degradation
- [ ] 99% uptime (excluding planned maintenance)
- [ ] 95% of users complete primary workflows on first attempt

**Technical** (from spec SC-007 to SC-010):
- [ ] Responsive design works on mobile/tablet/desktop
- [ ] Zero incidents of cross-user data access (100% isolation)
- [ ] Task data persists across sessions (zero data loss)
- [ ] Auth error rate < 1% for valid credentials

**Quality** (from spec SC-011 to SC-012):
- [ ] User satisfaction rating ≥ 4/5 stars
- [ ] Successful deployment to Vercel with automated build

---

## Architectural Decisions Requiring ADR

Based on research and design, the following significant architectural decisions may warrant ADRs:

1. **Monorepo Structure vs Separate Repositories**
   - Decision: Monorepo with frontend/ and backend/ in same repo
   - Rationale: Shared specifications, coordinated deployments, single source of truth
   - Alternative: Separate repos (rejected: coordination overhead, duplicate specs)
   - **Suggest ADR**: `/sp.adr "Monorepo Structure for Frontend and Backend"`

2. **JWT Authentication vs Session-Based Auth**
   - Decision: JWT tokens with Better Auth
   - Rationale: Stateless, scalable, works across separate domains (Vercel + Railway)
   - Alternative: Server-side sessions (rejected: requires shared session store, not stateless)
   - **Suggest ADR**: `/sp.adr "JWT Authentication with Better Auth"`

3. **Neon Serverless PostgreSQL vs Traditional PostgreSQL Hosting**
   - Decision: Neon Serverless with connection pooling
   - Rationale: Free tier sufficient, automatic backups, serverless scaling, branching for dev/prod
   - Alternative: Heroku Postgres, Supabase (rejected: cost, complexity)
   - **Suggest ADR**: `/sp.adr "Neon Serverless PostgreSQL for Database"`

4. **Next.js App Router vs Pages Router**
   - Decision: App Router with Server Components
   - Rationale: Latest Next.js architecture, better performance, constitutional requirement
   - Alternative: Pages Router (rejected: legacy, constitutional prohibition)
   - **Not requiring ADR** (constitutional mandate, no alternatives)

5. **Deployment Strategy: Vercel + Railway vs All-in-One Platform**
   - Decision: Vercel for frontend, Railway for backend, separate deployments
   - Rationale: Best-in-class hosting for each stack, independent scaling, constitutional requirement for Vercel
   - Alternative: Vercel for both (Next.js API routes + serverless functions) - rejected: Python backend requirement
   - **Suggest ADR**: `/sp.adr "Separate Frontend and Backend Deployment"`

**Recommendation**: Create ADRs for decisions 1, 2, 3, 5 after plan approval to document reasoning and tradeoffs.

---

## Next Steps

1. ✅ **Phase 0 Complete**: Research resolved all technical uncertainties
2. ✅ **Phase 1 Complete**: Design artifacts created (data model, API contracts, quickstart)
3. → **Run `/sp.tasks`**: Generate dependency-ordered implementation tasks
4. → **Review ADR suggestions**: Create architectural decision records for significant decisions
5. → **Begin Implementation**: Follow tasks.md with spec-driven development approach

---

## Plan Validation

**Constitution Compliance**: ✅ PASS (all 8 principles + constraints satisfied)
**Specification Coverage**: ✅ COMPLETE (all 37 FRs, 4 user stories, 12 success criteria addressed)
**Research Complete**: ✅ YES (zero NEEDS CLARIFICATION markers)
**Design Complete**: ✅ YES (data model, contracts, quickstart created)
**Architecture Defined**: ✅ YES (monorepo structure, JWT auth, RESTful API, responsive UI)
**Deployment Strategy**: ✅ YES (Vercel frontend, Railway backend, Neon database)

**Plan Status**: ✅ READY FOR TASK GENERATION

---

**Last Updated**: 2025-12-30
**Version**: 1.0.0
